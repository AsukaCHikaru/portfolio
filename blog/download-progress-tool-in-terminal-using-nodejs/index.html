<!doctype html>
<html lang="en">
  <head>
    <title>Download Progress Tool in Terminal Using Node.JS | Asuka Wang</title>
    <meta name="description" content="undefined">
    <meta name="author" content="Asuka Wang">
    <meta property="og:title" content="Download Progress Tool in Terminal Using Node.JS | Asuka Wang">
    <meta property="og:description" content="undefined">
  
    <meta charset="utf-8" />
    <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1" />
    <script type="module" src="/index.js" async></script>
    <link rel="stylesheet" href="/fonts.css" />
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/modern-normalize.css" />
    <link
      rel="preload"
      href="/fonts/CormorantGaramond-Regular.subset.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_NotoSerifJP_Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_NotoSerifJP_ExtraLight.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_latin_NotoSerifJP_Bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_latin_NotoSans_ExtraLight.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_latin_NotoSans_Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_GentiumBookPlus_Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_GentiumBookPlus_Bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_GentiumPlus_Italic.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
  <script>window.__STATIC_PROPS__ = {"blog":{"post":{"metadata":{"title":"Download Progress Tool in Terminal Using Node.JS","publishedAt":"2019-06-07","pathname":"download-progress-tool-in-terminal-using-nodejs","category":"note","topic":"programming","language":"en-US","featured":false},"content":[{"type":"heading","level":1,"body":[{"type":"textBody","style":"plain","value":"TL;DR:"}]},{"type":"list","ordered":false,"items":[{"type":"listItem","body":[{"type":"textBody","style":"code","value":"fs.stat"},{"type":"textBody","style":"plain","value":" for getting file size"}]},{"type":"listItem","body":[{"type":"textBody","style":"code","value":"readline.clearLine"}]},{"type":"listItem","body":[{"type":"textBody","style":"code","value":"readline.cursorTo(0)"}]},{"type":"listItem","body":[{"type":"textBody","style":"code","value":"process.stdout.write"}]}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"Combine these 3 to update command line instead of printing new line"}]},{"type":"heading","level":1,"body":[{"type":"textBody","style":"plain","value":"Get file size"}]},{"type":"paragraph","body":[{"type":"textBody","style":"code","value":"fs.stat"},{"type":"textBody","style":"plain","value":" returns an object contains several stats of the file from url you're downloading."}]},{"type":"paragraph","body":[{"type":"link","body":[{"type":"textBody","style":"plain","value":"Detailed explanation of fs.stat"}],"url":"https://nodejs.org/api/fs.html#fs_class_fs_stats"},{"type":"textBody","style":"plain","value":"."}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"Inside of the object, there is "},{"type":"textBody","style":"code","value":"size"},{"type":"textBody","style":"plain","value":" property, which is obviously the size of file, in bytes."}]},{"type":"code","lang":"js","body":"let fileSize = 0;\nfs.stat(\"url/to/your/file\", (stats) =\u003e {\n  fileSize = stats.size;\n});"},{"type":"heading","level":1,"body":[{"type":"textBody","style":"plain","value":"Get current progression"}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"In the response from "},{"type":"textBody","style":"code","value":"https.get"},{"type":"textBody","style":"plain","value":" when downloading, track and add up the total length of chunks piped into "},{"type":"textBody","style":"code","value":"fs.writeStream"},{"type":"textBody","style":"plain","value":". This total length devided by file size is the download progression we need."}]},{"type":"heading","level":1,"body":[{"type":"textBody","style":"plain","value":"Write to terminal, but in same line"}]},{"type":"paragraph","body":[{"type":"textBody","style":"code","value":"console.log"},{"type":"textBody","style":"plain","value":" "},{"type":"link","body":[{"type":"textBody","style":"plain","value":"implementation"}],"url":"https://nodejs.org/docs/v0.3.1/api/process.html#process.stdout"},{"type":"textBody","style":"plain","value":" in Node is actually based on "},{"type":"textBody","style":"code","value":"process.stdout.write"},{"type":"textBody","style":"plain","value":". But since there's a "},{"type":"textBody","style":"code","value":"\\\\n"},{"type":"textBody","style":"plain","value":" at end of every "},{"type":"textBody","style":"code","value":"console.log"},{"type":"textBody","style":"plain","value":", new line is printed everytime instead of being updated. Therefore we can't use "},{"type":"textBody","style":"code","value":"console.log"}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"By combine "},{"type":"textBody","style":"code","value":"readline.clearLine"},{"type":"textBody","style":"plain","value":" and "},{"type":"textBody","style":"code","value":"readline.cursorTo(0)"},{"type":"textBody","style":"plain","value":", terminal will erase the last line of currently printed line, then move cursor to the starting position. Then we can use "},{"type":"textBody","style":"code","value":"process.stdout.write"},{"type":"textBody","style":"plain","value":" to print out current progress without "},{"type":"textBody","style":"code","value":"\\\\n"},{"type":"textBody","style":"plain","value":" in "},{"type":"textBody","style":"code","value":"console.log"},{"type":"textBody","style":"plain","value":" implementation that causes changing line."}]},{"type":"code","lang":"js","body":"let progress = 0;\nlet req = https.get(\"url/to/your/file\", (res, err) =\u003e {\n  res.on(\"data\", (chunk) =\u003e {\n    progress += chunk.length;\n    const dlPercentage = ((progress / fileSize) * 100).toFixed(2);\n    readline.clearLine();\n    readline.cursorTo(0);\n    process.stdout.write(`Downloading... ${dlPercentage}%`);\n  });\n});"}]}},"lastUpdated":"2025-10-09"}</script></head>
  <body>
    <div id="root"><div><div class="site_container grid"><header class="site-header"><div class="header-content"><div class="header_left_content"><nav><a href="/blog">blog</a><a href="/about">about</a><a href="/blog/feed.xml">rss</a></nav><button type="button" class="frontpage-header-menu-button">menu</button></div><h1><a href="/">ASUKA WANG</a></h1><div class="header_right_content"></div></div><div class="header-divider"></div></header><main class="grid"><div class="post-page-header_container"><a href="/blog/?category=note">note</a><h1>Download Progress Tool in Terminal Using Node.JS</h1><h2></h2><p>June 7, 2019</p></div><article class="post-page-content grid"><h1>TL;DR:</h1><ul><li><code>fs.stat</code> for getting file size</li><li><code>readline.clearLine</code></li><li><code>readline.cursorTo(0)</code></li><li><code>process.stdout.write</code></li></ul><p>Combine these 3 to update command line instead of printing new line</p><h1>Get file size</h1><p><code>fs.stat</code> returns an object contains several stats of the file from url you&#x27;re downloading.</p><p><a href="https://nodejs.org/api/fs.html#fs_class_fs_stats" target="_blank" rel="noopener noreferrer">Detailed explanation of fs.stat</a>.</p><p>Inside of the object, there is <code>size</code> property, which is obviously the size of file, in bytes.</p><div><pre class="shiki gruvbox-light-soft" style="background-color:#f2e5bc;color:#3c3836" tabindex="0"><code><span class="line"><span style="color:#AF3A03">let</span><span style="color:#076678"> fileSize</span><span style="color:#427B58"> =</span><span style="color:#8F3F71"> 0;</span></span>
<span class="line"><span style="color:#076678">fs</span><span style="color:#7C6F64">.</span><span style="color:#B57614">stat</span><span style="color:#3C3836">(</span><span style="color:#7C6F64">"</span><span style="color:#79740E">url/to/your/file</span><span style="color:#7C6F64">"</span><span style="color:#7C6F64">,</span><span style="color:#7C6F64"> (</span><span style="color:#076678">stats</span><span style="color:#7C6F64">)</span><span style="color:#AF3A03"> =></span><span style="color:#7C6F64"> {</span></span>
<span class="line"><span style="color:#076678">  fileSize</span><span style="color:#427B58"> =</span><span style="color:#076678"> stats</span><span style="color:#7C6F64">.</span><span style="color:#076678">size</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#7C6F64">}</span><span style="color:#3C3836">)</span><span style="color:#7C6F64">;</span></span></code></pre></div><h1>Get current progression</h1><p>In the response from <code>https.get</code> when downloading, track and add up the total length of chunks piped into <code>fs.writeStream</code>. This total length devided by file size is the download progression we need.</p><h1>Write to terminal, but in same line</h1><p><code>console.log</code> <a href="https://nodejs.org/docs/v0.3.1/api/process.html#process.stdout" target="_blank" rel="noopener noreferrer">implementation</a> in Node is actually based on <code>process.stdout.write</code>. But since there&#x27;s a <code>\\n</code> at end of every <code>console.log</code>, new line is printed everytime instead of being updated. Therefore we can&#x27;t use <code>console.log</code></p><p>By combine <code>readline.clearLine</code> and <code>readline.cursorTo(0)</code>, terminal will erase the last line of currently printed line, then move cursor to the starting position. Then we can use <code>process.stdout.write</code> to print out current progress without <code>\\n</code> in <code>console.log</code> implementation that causes changing line.</p><div><pre class="shiki gruvbox-light-soft" style="background-color:#f2e5bc;color:#3c3836" tabindex="0"><code><span class="line"><span style="color:#AF3A03">let</span><span style="color:#076678"> progress</span><span style="color:#427B58"> =</span><span style="color:#8F3F71"> 0</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#AF3A03">let</span><span style="color:#076678"> req</span><span style="color:#427B58"> =</span><span style="color:#076678"> https</span><span style="color:#7C6F64">.</span><span style="color:#B57614">get</span><span style="color:#3C3836">(</span><span style="color:#7C6F64">"</span><span style="color:#79740E">url/to/your/file</span><span style="color:#7C6F64">"</span><span style="color:#7C6F64">,</span><span style="color:#7C6F64"> (</span><span style="color:#076678">res</span><span style="color:#7C6F64">,</span><span style="color:#076678"> err</span><span style="color:#7C6F64">)</span><span style="color:#AF3A03"> =></span><span style="color:#7C6F64"> {</span></span>
<span class="line"><span style="color:#076678">  res</span><span style="color:#7C6F64">.</span><span style="color:#B57614">on</span><span style="color:#3C3836">(</span><span style="color:#7C6F64">"</span><span style="color:#79740E">data</span><span style="color:#7C6F64">"</span><span style="color:#7C6F64">,</span><span style="color:#7C6F64"> (</span><span style="color:#076678">chunk</span><span style="color:#7C6F64">)</span><span style="color:#AF3A03"> =></span><span style="color:#7C6F64"> {</span></span>
<span class="line"><span style="color:#076678">    progress</span><span style="color:#427B58"> +=</span><span style="color:#076678"> chunk</span><span style="color:#7C6F64">.</span><span style="color:#8F3F71">length</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#AF3A03">    const</span><span style="color:#076678"> dlPercentage</span><span style="color:#427B58"> =</span><span style="color:#3C3836"> ((</span><span style="color:#076678">progress</span><span style="color:#427B58"> /</span><span style="color:#076678"> fileSize</span><span style="color:#3C3836">) </span><span style="color:#427B58">*</span><span style="color:#8F3F71"> 100</span><span style="color:#3C3836">)</span><span style="color:#7C6F64">.</span><span style="color:#B57614">toFixed</span><span style="color:#3C3836">(</span><span style="color:#8F3F71">2</span><span style="color:#3C3836">)</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#076678">    readline</span><span style="color:#7C6F64">.</span><span style="color:#B57614">clearLine</span><span style="color:#3C3836">()</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#076678">    readline</span><span style="color:#7C6F64">.</span><span style="color:#B57614">cursorTo</span><span style="color:#3C3836">(</span><span style="color:#8F3F71">0</span><span style="color:#3C3836">)</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#076678">    process</span><span style="color:#7C6F64">.</span><span style="color:#076678">stdout</span><span style="color:#7C6F64">.</span><span style="color:#B57614">write</span><span style="color:#3C3836">(</span><span style="color:#7C6F64">`</span><span style="color:#79740E">Downloading... </span><span style="color:#7C6F64">${</span><span style="color:#076678">dlPercentage</span><span style="color:#7C6F64">}</span><span style="color:#79740E">%</span><span style="color:#7C6F64">`</span><span style="color:#3C3836">)</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#7C6F64">  }</span><span style="color:#3C3836">)</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#7C6F64">}</span><span style="color:#3C3836">)</span><span style="color:#7C6F64">;</span></span></code></pre></div></article></main><footer class="site-footer_container">Asuka Wang © <!-- -->2025</footer></div></div></div>
  </body>
</html>
