<!doctype html>
<html lang="en">
  <head>
    <script type="module" src="/index.js" async></script>
    <link rel="stylesheet" href="/fonts.css" />
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/modern-normalize.css" />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_NotoSerifJP_Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_NotoSerifJP_ExtraLight.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_latin_NotoSerifJP_Bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_latin_NotoSans_Thin.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_GentiumBookPlus_Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_GentiumBookPlus_Bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/subset_extended_latin_GentiumPlus_Italic.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div id="root"><link rel="preload" as="image" href="/public/images/blog/nextjs-app-font-not-loaded-on-remote-machine-issue_1.png"/><link rel="preload" as="image" href="/public/images/blog/nextjs-app-font-not-loaded-on-remote-machine-issue_2.png"/><div><div class="site_container"><nav class="site-header_grid-wrapper"><div class="site-header_container"><div><a href="/blog">blog</a><a href="/about">about</a></div><a href="/">ASUKA WANG</a></div><div class="site-header_divider" role="presentation"></div></nav><main><div class="post-page-header_container"><h1>Next.js App Font Not Loaded on Remote Machine Issue</h1><h2>Debugging note of a source loading issue that never reproduces on the dev machine.</h2><p>June 5, 2023</p></div><article class="post-page-content"><h1>TL;DR</h1><p><code>@next/font</code> config <code>display: option</code> will switch to fallback if the font takes more than 100ms to load. To ensure the font loading, use <code>display: swap</code>.</p><h1>Issue</h1><p>This blog is built in Next.js. When I first released it, there was an issue that the font only loads on my development machine. It reproduces on every remote machine, even if I access the dev server from the same wifi.</p><h2>Configuration</h2><p>I hosted my font using local .woff2 file, which I downloaded as .otf from <a href="https://fonts.google.com/" target="_blank" rel="noopener noreferrer">google font</a> then converted to .woff2 from the first converter I found on google.</p><p>The font file is loaded from a <code>&lt;link&gt;</code> element in <code>_document.tsx</code>.</p><div><pre class="shiki gruvbox-light-soft" style="background-color:#f2e5bc;color:#3c3836" tabindex="0"><code><span class="line"><span style="color:#9D0006">export</span><span style="color:#9D0006"> default</span><span style="color:#AF3A03"> function</span><span style="color:#B57614"> Document</span><span style="color:#7C6F64">()</span><span style="color:#7C6F64"> {</span></span>
<span class="line"><span style="color:#9D0006">  return</span><span style="color:#3C3836"> (</span></span>
<span class="line"><span style="color:#076678">    &#x3C;</span><span style="color:#427B58">Html</span><span style="color:#B57614"> lang</span><span style="color:#427B58">=</span><span style="color:#7C6F64">"</span><span style="color:#79740E">en</span><span style="color:#7C6F64">"</span><span style="color:#076678">></span></span>
<span class="line"><span style="color:#076678">      &#x3C;</span><span style="color:#427B58">Head</span><span style="color:#076678"> /></span></span>
<span class="line"><span style="color:#076678">      &#x3C;</span><span style="color:#427B58">link</span></span>
<span class="line"><span style="color:#B57614">        rel</span><span style="color:#427B58">=</span><span style="color:#7C6F64">"</span><span style="color:#79740E">preload</span><span style="color:#7C6F64">"</span></span>
<span class="line"><span style="color:#B57614">        href</span><span style="color:#427B58">=</span><span style="color:#7C6F64">"</span><span style="color:#79740E">/fonts/NotoSerifJP-Regular.woff2</span><span style="color:#7C6F64">"</span></span>
<span class="line"><span style="color:#B57614">        as</span><span style="color:#427B58">=</span><span style="color:#7C6F64">"</span><span style="color:#79740E">font</span><span style="color:#7C6F64">"</span></span>
<span class="line"><span style="color:#B57614">        type</span><span style="color:#427B58">=</span><span style="color:#7C6F64">"</span><span style="color:#79740E">font/woff2</span><span style="color:#7C6F64">"</span></span>
<span class="line"><span style="color:#076678">      /></span></span>
<span class="line"><span style="color:#076678">      &#x3C;</span><span style="color:#427B58">body</span><span style="color:#076678">></span></span>
<span class="line"><span style="color:#076678">        &#x3C;</span><span style="color:#427B58">Main</span><span style="color:#076678"> /></span></span>
<span class="line"><span style="color:#076678">        &#x3C;</span><span style="color:#427B58">NextScript</span><span style="color:#076678"> /></span></span>
<span class="line"><span style="color:#076678">      &#x3C;/</span><span style="color:#427B58">body</span><span style="color:#076678">></span></span>
<span class="line"><span style="color:#076678">    &#x3C;/</span><span style="color:#427B58">Html</span><span style="color:#076678">></span></span>
<span class="line"><span style="color:#3C3836">  )</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#7C6F64">}</span></span></code></pre></div><p>Then I set the font face in <code>global.css</code> and applied the <code>font-family</code> to <code>body</code>.</p><div><pre class="shiki gruvbox-light-soft" style="background-color:#f2e5bc;color:#3c3836" tabindex="0"><code><span class="line"><span style="color:#7C6F64">@</span><span style="color:#9D0006">font-face</span><span style="color:#7C6F64"> {</span></span>
<span class="line"><span style="color:#AF3A03">  font-family</span><span style="color:#7C6F64">:</span><span style="color:#7C6F64"> "</span><span style="color:#79740E">NotoSerifJP</span><span style="color:#7C6F64">"</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#AF3A03">  font-style</span><span style="color:#7C6F64">:</span><span style="color:#8F3F71"> normal</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#AF3A03">  font-weight</span><span style="color:#7C6F64">:</span><span style="color:#8F3F71"> 400</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#AF3A03">  font-display</span><span style="color:#7C6F64">:</span><span style="color:#8F3F71"> optional</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#AF3A03">  src</span><span style="color:#7C6F64">:</span><span style="color:#3C3836"> url</span><span style="color:#7C6F64">(</span><span style="color:#076678">/fonts/NotoSerifJP-Regular.woff2</span><span style="color:#7C6F64">)</span><span style="color:#9D0006"> format</span><span style="color:#7C6F64">(</span><span style="color:#076678">woff2</span><span style="color:#7C6F64">);</span></span>
<span class="line"><span style="color:#7C6F64">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#427B58">html</span><span style="color:#7C6F64">,</span></span>
<span class="line"><span style="color:#427B58">body</span><span style="color:#7C6F64"> {</span></span>
<span class="line"><span style="color:#AF3A03">  font-family</span><span style="color:#7C6F64">:</span><span style="color:#7C6F64"> "</span><span style="color:#79740E">NotoSerifJP</span><span style="color:#7C6F64">"</span><span style="color:#7C6F64">;</span></span>
<span class="line"><span style="color:#7C6F64">}</span></span></code></pre></div><h2>Behavior</h2><p>When access either the dev server or the prod environment from the development machine, the font loads successfully. But when access from any other single machine on the world, the font won&#x27;t load and the app switches back to default sans font.</p><p>The font file is successfully fetched on either machine, but on the remote machine the fetched font&#x27;s content becomes the default sans font. I used some online .woff2 preview tool and it clearly shows that the downloaded .woff2 file is the default sans font. Such issue didn&#x27;t happen on the development machine.</p><figure><img src="/public/images/blog/nextjs-app-font-not-loaded-on-remote-machine-issue_1.png" alt=""/><figcaption>Font file response on development machine</figcaption></figure><figure><img src="/public/images/blog/nextjs-app-font-not-loaded-on-remote-machine-issue_2.png" alt=""/><figcaption>Font file response on remote machine</figcaption></figure><h2>Attempts</h2><p>I tried the configurations shown in <a href="https://www.youtube.com/watch?v=L8_98i_bMMA" target="_blank" rel="noopener noreferrer">this youtube video</a>.</p><p>(It was super easy to understand, turns out it was a Vercel&#x27;s developer&#x27;s channel.)</p><p>I discarded the local .woff2 file and tried <code>@next/font</code>. Since I was using Tailwindcss, I set the font variable and the <code>tainwind.config.js</code> configurations.</p><p>After above configuration, the latin part of the font started to load on remote machine. Only the Japanese and Chinese parts remain the default sans font.</p><h2>Root Cause</h2><p>When creating font const using <code>@next/font</code>, the <code>display</code> option is defaulted to <code>optional</code>, which will switch to fallback font if the loading time is over 100ms.</p><p>Since I was using <a href="https://fonts.google.com/noto/specimen/Noto+Serif+JP?query=noto+se" target="_blank" rel="noopener noreferrer">Noto Serif JP</a>, the Japanese subset is way heavier than the latin set, which makes the Japanese part fallbacks to default font.</p><p>When I was hosting the .woff2 file instead of using <code>@next/font</code>, I didn&#x27;t set the subset rules, hence made the whole font file too big to load, thus on every remote machine the font fallbacks. Only on the development machine, the font was not loaded through http but local disc, which it makes the below 100ms line.</p><h2>Solution</h2><p>Use <code>display: swap</code> to ensure font loading.</p><p>It causes some <a href="https://fonts.google.com/knowledge/glossary/fout" target="_blank" rel="noopener noreferrer">FOUT</a>, but it&#x27;s a way lesser evil compare to the origin issue.</p><h1>References</h1><ul><li><a href="https://www.satoooh.org/posts/next-font-display" target="_blank" rel="noopener noreferrer">@next/font で初回読み込み時にフォントが適用されない</a></li></ul></article></main><footer class="site-footer_container">Asuka Wang © <!-- -->2025</footer></div></div></div><script>window.__STATIC_PROPS__ = {"blog":{"post":{"metadata":{"title":"Next.js App Font Not Loaded on Remote Machine Issue","description":"Debugging note of a source loading issue that never reproduces on the dev machine.","publishedAt":"2023-06-05","pathname":"nextjs-app-font-not-loaded-on-remote-machine-issue","category":"research","topic":"web development","language":"en-US","featured":false,"thumbnail":"nextjs-app-font-not-loaded-on-remote-machine-issue_2.png"},"content":[{"type":"heading","level":1,"body":[{"type":"textBody","style":"plain","value":"TL;DR"}]},{"type":"paragraph","body":[{"type":"textBody","style":"code","value":"@next/font"},{"type":"textBody","style":"plain","value":" config "},{"type":"textBody","style":"code","value":"display: option"},{"type":"textBody","style":"plain","value":" will switch to fallback if the font takes more than 100ms to load. To ensure the font loading, use "},{"type":"textBody","style":"code","value":"display: swap"},{"type":"textBody","style":"plain","value":"."}]},{"type":"heading","level":1,"body":[{"type":"textBody","style":"plain","value":"Issue"}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"This blog is built in Next.js. When I first released it, there was an issue that the font only loads on my development machine. It reproduces on every remote machine, even if I access the dev server from the same wifi."}]},{"type":"heading","level":2,"body":[{"type":"textBody","style":"plain","value":"Configuration"}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"I hosted my font using local .woff2 file, which I downloaded as .otf from "},{"type":"link","body":[{"type":"textBody","style":"plain","value":"google font"}],"url":"https://fonts.google.com/"},{"type":"textBody","style":"plain","value":" then converted to .woff2 from the first converter I found on google."}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"The font file is loaded from a "},{"type":"textBody","style":"code","value":"\u003clink\u003e"},{"type":"textBody","style":"plain","value":" element in "},{"type":"textBody","style":"code","value":"_document.tsx"},{"type":"textBody","style":"plain","value":"."}]},{"type":"code","lang":"tsx","body":"export default function Document() {\n  return (\n    \u003cHtml lang=\"en\"\u003e\n      \u003cHead /\u003e\n      \u003clink\n        rel=\"preload\"\n        href=\"/fonts/NotoSerifJP-Regular.woff2\"\n        as=\"font\"\n        type=\"font/woff2\"\n      /\u003e\n      \u003cbody\u003e\n        \u003cMain /\u003e\n        \u003cNextScript /\u003e\n      \u003c/body\u003e\n    \u003c/Html\u003e\n  );\n}"},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"Then I set the font face in "},{"type":"textBody","style":"code","value":"global.css"},{"type":"textBody","style":"plain","value":" and applied the "},{"type":"textBody","style":"code","value":"font-family"},{"type":"textBody","style":"plain","value":" to "},{"type":"textBody","style":"code","value":"body"},{"type":"textBody","style":"plain","value":"."}]},{"type":"code","lang":"css","body":"@font-face {\n  font-family: \"NotoSerifJP\";\n  font-style: normal;\n  font-weight: 400;\n  font-display: optional;\n  src: url(/fonts/NotoSerifJP-Regular.woff2) format(woff2);\n}\n\nhtml,\nbody {\n  font-family: \"NotoSerifJP\";\n}"},{"type":"heading","level":2,"body":[{"type":"textBody","style":"plain","value":"Behavior"}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"When access either the dev server or the prod environment from the development machine, the font loads successfully. But when access from any other single machine on the world, the font won't load and the app switches back to default sans font."}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"The font file is successfully fetched on either machine, but on the remote machine the fetched font's content becomes the default sans font. I used some online .woff2 preview tool and it clearly shows that the downloaded .woff2 file is the default sans font. Such issue didn't happen on the development machine."}]},{"type":"image","url":"nextjs-app-font-not-loaded-on-remote-machine-issue_1.png","altText":"","caption":"Font file response on development machine"},{"type":"image","url":"nextjs-app-font-not-loaded-on-remote-machine-issue_2.png","altText":"","caption":"Font file response on remote machine"},{"type":"heading","level":2,"body":[{"type":"textBody","style":"plain","value":"Attempts"}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"I tried the configurations shown in "},{"type":"link","body":[{"type":"textBody","style":"plain","value":"this youtube video"}],"url":"https://www.youtube.com/watch?v=L8_98i_bMMA"},{"type":"textBody","style":"plain","value":"."}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"(It was super easy to understand, turns out it was a Vercel's developer's channel.)"}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"I discarded the local .woff2 file and tried "},{"type":"textBody","style":"code","value":"@next/font"},{"type":"textBody","style":"plain","value":". Since I was using Tailwindcss, I set the font variable and the "},{"type":"textBody","style":"code","value":"tainwind.config.js"},{"type":"textBody","style":"plain","value":" configurations."}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"After above configuration, the latin part of the font started to load on remote machine. Only the Japanese and Chinese parts remain the default sans font."}]},{"type":"heading","level":2,"body":[{"type":"textBody","style":"plain","value":"Root Cause"}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"When creating font const using "},{"type":"textBody","style":"code","value":"@next/font"},{"type":"textBody","style":"plain","value":", the "},{"type":"textBody","style":"code","value":"display"},{"type":"textBody","style":"plain","value":" option is defaulted to "},{"type":"textBody","style":"code","value":"optional"},{"type":"textBody","style":"plain","value":", which will switch to fallback font if the loading time is over 100ms."}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"Since I was using "},{"type":"link","body":[{"type":"textBody","style":"plain","value":"Noto Serif JP"}],"url":"https://fonts.google.com/noto/specimen/Noto+Serif+JP?query=noto+se"},{"type":"textBody","style":"plain","value":", the Japanese subset is way heavier than the latin set, which makes the Japanese part fallbacks to default font."}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"When I was hosting the .woff2 file instead of using "},{"type":"textBody","style":"code","value":"@next/font"},{"type":"textBody","style":"plain","value":", I didn't set the subset rules, hence made the whole font file too big to load, thus on every remote machine the font fallbacks. Only on the development machine, the font was not loaded through http but local disc, which it makes the below 100ms line."}]},{"type":"heading","level":2,"body":[{"type":"textBody","style":"plain","value":"Solution"}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"Use "},{"type":"textBody","style":"code","value":"display: swap"},{"type":"textBody","style":"plain","value":" to ensure font loading."}]},{"type":"paragraph","body":[{"type":"textBody","style":"plain","value":"It causes some "},{"type":"link","body":[{"type":"textBody","style":"plain","value":"FOUT"}],"url":"https://fonts.google.com/knowledge/glossary/fout"},{"type":"textBody","style":"plain","value":", but it's a way lesser evil compare to the origin issue."}]},{"type":"heading","level":1,"body":[{"type":"textBody","style":"plain","value":"References"}]},{"type":"list","ordered":false,"items":[{"type":"listItem","body":[{"type":"link","body":[{"type":"textBody","style":"plain","value":"@next/font で初回読み込み時にフォントが適用されない"}],"url":"https://www.satoooh.org/posts/next-font-display"}]}]}]}}}</script>
  </body>
</html>
